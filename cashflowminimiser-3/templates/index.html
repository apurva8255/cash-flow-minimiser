<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cash Flow Minimiser</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { background-color: #000000; color: #E5E7EB; font-family: 'Inter', sans-serif; }
        .font-roboto-mono { font-family: 'Roboto Mono', monospace; }
        .nav-link { transition: all 0.3s ease; letter-spacing: 0.2em; }
        .nav-link:hover { color: #06B6D4; text-shadow: 0 0 10px #06B6D4; }
        .gemini-button, .optimize-button { background: #06B6D4; transition: all 0.3s ease; box-shadow: 0 0 15px rgba(6, 182, 212, 0.5); }
        .gemini-button:hover, .optimize-button:hover { transform: translateY(-2px); box-shadow: 0 0 25px rgba(6, 182, 212, 0.8); }
        .input-field { background-color: #111827; border: 1px solid #374151; color: #E5E7EB; }
        .input-field:focus { outline: none; border-color: #06B6D4; box-shadow: 0 0 0 2px rgba(6, 182, 212, 0.5); }
        .card { background-color: rgba(17, 24, 39, 0.8); backdrop-filter: blur(10px); border: 1px solid #374151; }
        .transaction-item, .gemini-item { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        #bg-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.3; }
        .output-pre, .gemini-textarea { background-color: #030712; color: #E5E7EB; border: 1px solid #374151; }
        .tone-button { transition: all 0.2s ease; border: 1px solid #374151; }
        .tone-button.active { background-color: #06B6D4; color: #000; border-color: #06B6D4; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #06B6D4; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .modal-overlay { animation: fadeIn 0.3s ease-out forwards; }
        .modal-content { animation: fadeIn 0.3s ease-out 0.1s forwards; opacity: 0; }
    </style>
</head>
<body class="antialiased">
    <canvas id="bg-canvas"></canvas>

    <div class="relative min-h-screen flex flex-col items-center p-4 sm:p-6 md:p-8">
        <header class="w-full max-w-7xl">
            <nav class="flex justify-center sm:justify-between items-center py-4">
                <div class="hidden sm:block text-2xl font-bold font-roboto-mono tracking-widest">CASH FLOW <span class="text-cyan-400">MINIMISER</span></div>
                <div class="flex space-x-8 md:space-x-12 text-sm">
                    <a href="#" id="how-it-works-link" class="nav-link uppercase">How It Works</a>
                    <a href="#" class="nav-link uppercase">Contact</a>
                    <a href="#" id="save-chat-link" class="nav-link uppercase">Save Chat</a>
                </div>
            </nav>
        </header>

        <main class="flex-grow flex flex-col items-center justify-center text-center w-full max-w-7xl z-10">
            <div class="my-16">
                 <h1 class="text-6xl sm:text-7xl md:text-8xl font-bold tracking-tighter text-gray-200">Cash Flow <span class="text-cyan-400">Minimiser</span></h1>
                <p class="mt-6 text-gray-400 max-w-lg mx-auto text-center">Minimize transactions, simplify debts, and optimize your cash flow with algorithmic precision.</p>
            </div>

            <div class="w-full max-w-4xl flex flex-col items-center">
                <div class="w-full card p-6 rounded-lg mb-8">
                    <h2 class="text-2xl font-bold mb-4 text-cyan-400 text-center">Enter Transactions</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-2 mb-4">
                        <input type="text" id="payer" placeholder="Payer's Name" class="input-field p-2 rounded" required>
                        <input type="text" id="receiver" placeholder="Receiver's Name" class="input-field p-2 rounded" required>
                        <input type="number" id="amount" placeholder="Amount" min="0.01" step="0.01" class="input-field p-2 rounded" required>
                    </div>
                    <button type="button" id="add-transaction-btn" class="bg-cyan-500/20 text-cyan-300 hover:bg-cyan-500/40 font-bold p-2 rounded transition-colors w-full">Add Transaction</button>
                    <h3 class="text-lg font-semibold mt-6 mb-2 text-left">Transaction List:</h3>
                    <ul id="transactions-list" class="space-y-2 text-left">
                        <li class="text-gray-500 italic">No transactions added yet.</li>
                    </ul>
                </div>
                
                <button type="button" id="optimize-button" class="optimize-button text-black font-bold text-lg py-3 px-12 rounded-lg mb-8">Optimize Now</button>
            </div>

            <div id="results-container" class="w-full max-w-4xl card p-6 rounded-lg mb-8 hidden">
                <h2 class="text-3xl font-bold mb-2 text-center">ðŸ“Š Optimization Results</h2>
                <pre id="output-pre" class="output-pre font-roboto-mono text-sm sm:text-base p-4 rounded-lg whitespace-pre-wrap word-wrap break-word max-h-96 overflow-y-auto"></pre>
                <button id="generate-reminder-btn" class="gemini-button w-full mt-4 text-black font-bold py-2 px-4 rounded-lg">âœ¨ Generate Reminder Message</button>
            </div>

            <div id="gemini-container" class="w-full max-w-4xl card p-6 rounded-lg mb-8 hidden gemini-item">
                <h2 class="text-3xl font-bold mb-4 text-center">âœ¨ AI-Powered Reminder</h2>
                <div class="mb-4">
                    <p class="text-gray-400 mb-2">Select a tone:</p>
                    <div id="tone-selector" class="flex justify-center space-x-2">
                        <button class="tone-button active px-4 py-2 rounded-md" data-tone="Friendly">Friendly</button>
                        <button class="tone-button px-4 py-2 rounded-md" data-tone="Formal">Formal</button>
                        <button class="tone-button px-4 py-2 rounded-md" data-tone="Funny">Funny</button>
                    </div>
                </div>
                <div id="gemini-loader" class="hidden flex justify-center items-center my-4"><div class="loader"></div></div>
                <textarea id="gemini-output" class="gemini-textarea w-full h-48 p-3 rounded-lg font-roboto-mono text-sm" placeholder="Your generated reminder will appear here..."></textarea>
                <button id="copy-reminder-btn" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg w-full mt-4">Copy Message</button>
                <p id="copy-feedback" class="text-green-400 text-sm mt-2 h-4"></p>
            </div>
        </main>
    </div>

    <!-- How It Works Modal -->
    <div id="how-it-works-modal" class="modal-overlay fixed inset-0 bg-black/70 flex items-center justify-center p-4 hidden z-50">
        <div class="modal-content card max-w-2xl w-full p-8 rounded-lg relative text-left">
            <button id="close-modal-btn" class="absolute top-4 right-4 text-gray-500 hover:text-white text-3xl font-bold">&times;</button>
            <h2 class="text-3xl font-bold mb-4 text-cyan-400">How It Works</h2>
            <div class="space-y-4 text-gray-300">
                <div><h3 class="font-bold text-lg text-white">Step 1: Add Transactions</h3><p>Enter the name of the person who paid, the person who should have received the money, and the amount. Click "Add Transaction".</p></div>
                <div><h3 class="font-bold text-lg text-white">Step 2: Optimize Debts</h3><p>Click "Optimize Now". The algorithm will calculate the simplest way for everyone to settle their debts.</p></div>
                <div><h3 class="font-bold text-lg text-white">Step 3: View Results</h3><p>The app will display who owes money, who is owed, and the final list of payments needed to settle everything.</p></div>
                <div><h3 class="font-bold text-lg text-white">Step 4: Generate AI Reminders</h3><p>Click "âœ¨ Generate Reminder Message", choose a tone, and the Gemini AI will write a polite message you can copy into your group chat.</p></div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const addTransactionBtn = document.getElementById('add-transaction-btn');
        const transactionsList = document.getElementById('transactions-list');
        const optimizeButton = document.getElementById('optimize-button');
        const resultsContainer = document.getElementById('results-container');
        const outputPre = document.getElementById('output-pre');
        const generateReminderBtn = document.getElementById('generate-reminder-btn');
        const geminiContainer = document.getElementById('gemini-container');
        const geminiLoader = document.getElementById('gemini-loader');
        const geminiOutput = document.getElementById('gemini-output');
        const copyReminderBtn = document.getElementById('copy-reminder-btn');
        const toneSelector = document.getElementById('tone-selector');
        const copyFeedback = document.getElementById('copy-feedback');
        const howItWorksLink = document.getElementById('how-it-works-link');
        const howItWorksModal = document.getElementById('how-it-works-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const saveChatLink = document.getElementById('save-chat-link');
        let transactions = [];

        const renderList = () => {
            if (transactions.length === 0) {
                transactionsList.innerHTML = `<li class="text-gray-500 italic">No transactions added yet.</li>`;
                return;
            }
            transactionsList.innerHTML = transactions.map((t, i) => `
                <li class="flex justify-between items-center bg-gray-800 p-2 rounded transaction-item">
                    <span><span class="font-bold text-red-400">${t.payer}</span> pays <span class="font-bold text-cyan-400">${t.receiver}</span> <span class="font-roboto-mono">$${parseFloat(t.amount).toFixed(2)}</span></span>
                    <button data-index="${i}" class="remove-btn text-gray-500 hover:text-red-400 text-xl font-bold">&times;</button>
                </li>`).join('');
        };

        addTransactionBtn.addEventListener('click', () => {
            const payerInput = document.getElementById('payer');
            const receiverInput = document.getElementById('receiver');
            const amountInput = document.getElementById('amount');
            const payer = payerInput.value.trim();
            const receiver = receiverInput.value.trim();
            const amount = parseFloat(amountInput.value);
            if (payer && receiver && !isNaN(amount) && amount > 0) {
                if (payer.toLowerCase() === receiver.toLowerCase()) {
                    alert("Payer and Receiver cannot be the same.");
                    return;
                }
                transactions.push({ payer, receiver, amount });
                payerInput.value = '';
                receiverInput.value = '';
                amountInput.value = '';
                payerInput.focus();
                renderList();
            } else {
                alert("Please fill out all fields with valid values.")
            }
        });

        transactionsList.addEventListener('click', (e) => {
            if (e.target.classList.contains('remove-btn')) {
                const index = parseInt(e.target.dataset.index);
                transactions.splice(index, 1);
                renderList();
            }
        });

        optimizeButton.addEventListener('click', async () => {
            if (transactions.length === 0) {
                alert("Please add at least one transaction before optimizing.");
                return;
            }
            try {
                const response = await fetch('/run', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ transactions: transactions }),
                });
                const data = await response.json();
                outputPre.textContent = data.error || data.output;
            } catch (error) {
                outputPre.textContent = "Error: Could not connect to the backend server. Is the `python app.py` server running in your terminal?";
                console.error("Fetch error:", error);
            }
            resultsContainer.classList.remove('hidden');
            geminiContainer.classList.add('hidden');
        });

        toneSelector.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON') {
                document.querySelectorAll('.tone-button').forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');
                generateReminderBtn.click();
            }
        });

        generateReminderBtn.addEventListener('click', async () => {
            const settlementText = outputPre.textContent;
            if (!settlementText || settlementText.toLowerCase().includes('error')) {
                geminiContainer.classList.remove('hidden');
                geminiOutput.value = "Cannot generate a reminder because the optimization step failed. Please resolve the error above.";
                return;
            }
            geminiContainer.classList.remove('hidden');
            geminiOutput.value = '';
            geminiLoader.classList.remove('hidden');
            const activeToneButton = document.querySelector('.tone-button.active');
            const tone = activeToneButton ? activeToneButton.dataset.tone : 'Friendly';
            try {
                const response = await fetch('/generate-reminder', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ settlements: settlementText, tone: tone }),
                });
                const data = await response.json();
                geminiOutput.value = data.error || data.reminder;
            } catch (error) {
                geminiOutput.value = "Error: Could not connect to the backend for AI reminder generation.";
                console.error("Fetch error:", error);
            } finally {
                geminiLoader.classList.add('hidden');
            }
        });

        copyReminderBtn.addEventListener('click', () => {
            geminiOutput.select();
            document.execCommand('copy');
            copyFeedback.textContent = 'Copied to clipboard!';
            setTimeout(() => { copyFeedback.textContent = ''; }, 2000);
        });

        renderList();
        howItWorksLink.addEventListener('click', (e) => { e.preventDefault(); howItWorksModal.classList.remove('hidden'); });
        closeModalBtn.addEventListener('click', () => { howItWorksModal.classList.add('hidden'); });
        howItWorksModal.addEventListener('click', (e) => { if (e.target === howItWorksModal) { howItWorksModal.classList.add('hidden'); } });
        saveChatLink.addEventListener('click', (e) => { e.preventDefault(); const date = new Date().toLocaleString(); let contentToSave = `Cash Flow Minimiser Session\nSaved on: ${date}\n========================================\n\n--- TRANSACTIONS ---\n`; if (transactions.length > 0) { transactions.forEach(t => { contentToSave += `${t.payer} pays ${t.receiver} $${parseFloat(t.amount).toFixed(2)}\n`; }); } else { contentToSave += `No transactions were added.\n`; } contentToSave += `\n--- OPTIMIZATION RESULTS ---\n`; const resultsText = outputPre.textContent; if (resultsContainer.classList.contains('hidden') || !resultsText.trim()) { contentToSave += `No optimization results were generated.\n`; } else { contentToSave += resultsText + `\n`; } contentToSave += `\n--- AI REMINDER MESSAGE ---\n`; const geminiText = geminiOutput.value; if (geminiContainer.classList.contains('hidden') || !geminiText.trim()) { contentToSave += `No AI reminder was generated.\n`; } else { const activeToneButton = document.querySelector('.tone-button.active'); const tone = activeToneButton ? activeToneButton.dataset.tone : 'N/A'; contentToSave += `Tone: ${tone}\n\n${geminiText}\n`; } const blob = new Blob([contentToSave], { type: 'text/plain;charset=utf-8' }); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'cashflow-session.txt'; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url); });
        const canvas = document.getElementById('bg-canvas'); const ctx = canvas.getContext('2d'); let particles = []; const particleCount = 50; const resizeCanvas = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }; class Particle { constructor() { this.x = Math.random() * canvas.width; this.y = Math.random() * canvas.height; this.vx = (Math.random() - 0.5) * 0.5; this.vy = (Math.random() - 0.5) * 0.5; this.radius = Math.random() * 2 + 1; } update() { this.x += this.vx; this.y += this.vy; if (this.x < 0 || this.x > canvas.width) this.vx *= -1; if (this.y < 0 || this.y > canvas.height) this.vy *= -1; } draw() { ctx.beginPath(); ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2); ctx.fillStyle = 'rgba(6, 182, 212, 0.8)'; ctx.fill(); } } const initParticles = () => { particles = []; for (let i = 0; i < particleCount; i++) { particles.push(new Particle()); } }; const animate = () => { ctx.clearRect(0, 0, canvas.width, canvas.height); for (let i = 0; i < particles.length; i++) { particles[i].update(); particles[i].draw(); for (let j = i + 1; j < particles.length; j++) { const dx = particles[i].x - particles[j].x; const dy = particles[i].y - particles[j].y; const distance = Math.sqrt(dx * dx + dy * dy); if (distance < 150) { ctx.beginPath(); ctx.moveTo(particles[i].x, particles[i].y); ctx.lineTo(particles[j].x, particles[j].y); ctx.strokeStyle = `rgba(6, 182, 212, ${1 - distance / 150})`; ctx.lineWidth = 0.5; ctx.stroke(); } } } requestAnimationFrame(animate); }; window.addEventListener('resize', () => { resizeCanvas(); initParticles(); }); resizeCanvas(); initParticles(); animate();
    });
    </script>
</body>
</html>

